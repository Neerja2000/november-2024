

<div class="container-fluid ">


  <div class="row">
    <div class="col-lg-12 align-items-stretch mt-5">
      <div class="row">
        <div class="col-6 col-lg-4 col-md-6">
          <div class="card">
            <div class="card-body px-4 py-4-5">
              <div class="row align-items-center">
                <div class="col-4">
                  <div class="d-flex justify-content-center">
                    <div class="icon-wrapper text-white bg-secondary rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-person-fill fs-6"></i>
                    </div>
                  </div>
                </div>
                <div class="col-8">
                  <h6 class="text-muted font-semibold">Total Users</h6>
                  <h6 class="font-extrabold mb-0">112</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="col-6 col-lg-4 col-md-6">
          <div class="card">
            <div class="card-body px-4 py-4-5">
              <div class="row align-items-center">
                <div class="col-4">
                  <div class="d-flex justify-content-center">
                    <div class="icon-wrapper text-white bg-secondary rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-person-plus-fill fs-6"></i>
                    </div>
                  </div>
                </div>
                <div class="col-8">
                  <h6 class="text-muted font-semibold">New Users</h6>
                  <h6 class="font-extrabold mb-0">10</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <div class="col-6 col-lg-4 col-md-6">
          <div class="card">
            <div class="card-body px-4 py-4-5">
              <div class="row align-items-center">
                <div class="col-4">
                  <div class="d-flex justify-content-center">
                    <div class="icon-wrapper text-white bg-secondary rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-box-arrow-in-right fs-6"></i>
                    </div>
                  </div>
                </div>
                <div class="col-8">
                  <h6 class="text-muted font-semibold">Products</h6>
                  <h6 class="font-extrabold mb-0">2</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header text-white bg-primary">
            <h2 class="mb-0">View EMIs</h2>
          </div>
          <div class="card-body">
            <!-- Tabs Navigation -->
            <ul class="nav nav-tabs" id="emiTabs" role="tablist">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  id="upcoming-tab"
                  data-bs-toggle="tab"
                  href="#upcoming"
                  role="tab"
                  aria-controls="upcoming"
                  aria-selected="true"
                  >Upcoming</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  id="pending-tab"
                  data-bs-toggle="tab"
                  href="#pending"
                  role="tab"
                  aria-controls="pending"
                  aria-selected="false"
                  >Pending</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  id="settled-tab"
                  data-bs-toggle="tab"
                  href="#settled"
                  role="tab"
                  aria-controls="settled"
                  aria-selected="false"
                  >Settled</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  id="all-tab"
                  data-bs-toggle="tab"
                  href="#all"
                  role="tab"
                  aria-controls="all"
                  aria-selected="false"
                  >All</a
                >
              </li>
            </ul>
  
            <!-- Tab Content -->
            <div class="tab-content mt-4" id="emiTabsContent">
              <!-- Upcoming Tab -->
              <div
                class="tab-pane fade show active"
                id="upcoming"
                role="tabpanel"
                aria-labelledby="upcoming-tab"
              >
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>SR NO.</th>
                      <th>NAME</th>
                      <th>PHONE NO.</th>
                      <th>TRANSACTION AMOUNT</th>
                      <th>EMI+INTEREST</th>
                      <th>STATUS</th>
                      <th>DATE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let emi of futureUnsettledEmis; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td class="text-bold-500">{{ emi.name }}</td>
                      <td>{{ emi.phone }}</td>
                      <td>₹{{ emi.transactionAmount }}</td>
                      <td>₹{{ emi.emi_with_interest }}</td> 
                      <button
  *ngIf="emi.settled === 0"
  class="btn btn-primary"
  data-bs-toggle="modal"
  data-bs-target="#openSettleModal"
  (click)="openSettleModal(emi)"
>
  Settle
</button>

<button
  *ngIf="emi.settled === 1"
  class="btn btn-secondary"
  disabled
>
  Settled
</button>
                      <td>{{ emi.due_date | date: 'yyyy-MM-dd' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
  
              <!-- Pending Tab -->
              <div
                class="tab-pane fade"
                id="pending"
                role="tabpanel"
                aria-labelledby="pending-tab"
              >
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>SR NO.</th>
                      <th>NAME</th>
                      <th>PHONE NO.</th>
                      <th>TRANSACTION AMOUNT</th>
                      <th>EMI+INTEREST</th>
                      <th>STATUS</th>
                      <th>DATE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let emi of pastUnsettledEmis; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td class="text-bold-500">{{ emi.name }}</td>
                      <td>{{ emi.phone }}</td>
                      <td>₹{{ emi.transactionAmount }}</td>
                      <td>₹{{ emi.emi_with_interest }}</td>  
                      <button
  *ngIf="emi.settled === 0"
  class="btn btn-primary"
  data-bs-toggle="modal"
  data-bs-target="#openSettleModal"
  (click)="openSettleModal(emi)"
>
  Settle
</button>

<button
  *ngIf="emi.settled === 1"
  class="btn btn-secondary"
  disabled
>
  Settled
</button>
                      <td>{{ emi.due_date | date: 'yyyy-MM-dd' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
  
              <!-- Settled Tab -->
              <div
                class="tab-pane fade"
                id="settled"
                role="tabpanel"
                aria-labelledby="settled-tab"
              >
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>SR NO.</th>
                      <th>NAME</th>
                      <th>PHONE NO.</th>
                      <th>TRANSACTION AMOUNT</th>
                      <th>EMI+INTEREST</th>
                      <th>STATUS</th>
                      <th>DATE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let emi of emisList; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td class="text-bold-500">{{ emi.name }}</td>
                      <td>{{ emi.phone }}</td>
                      <td>₹{{ emi.transactionAmount }}</td>
                      <td>₹{{ emi.emi_with_interest }}</td> 
                      <button
  *ngIf="emi.settled === 0"
  class="btn btn-primary"
  data-bs-toggle="modal"
  data-bs-target="#openSettleModal"
  (click)="openSettleModal(emi)"
>
  Settle
</button>

<button
  *ngIf="emi.settled === 1"
  class="btn btn-secondary"
  disabled
>
  Settled
</button>
                      <td>{{ emi.due_date | date: 'yyyy-MM-dd' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
  
              <!-- All Tab -->
              <div
                class="tab-pane fade"
                id="all"
                role="tabpanel"
                aria-labelledby="all-tab"
              >
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>SR NO.</th>
                      <th>NAME</th>
                      <th>PHONE NO.</th>
                      <th>TRANSACTION AMOUNT</th>
                      <th>EMI+INTEREST</th>
                      <th>STATUS</th>
                      <th>DATE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let emi of futureUnsettledEmis.concat(pastUnsettledEmis).concat(emisList); let i = index">
                      <td>{{ i + 1 }}</td>
                      <td class="text-bold-500">{{ emi.name }}</td>
                      <td>{{ emi.phone }}</td>
                      <td>₹{{ emi.transactionAmount }}</td>
                      <td>₹{{ emi.emi_with_interest }}</td>
                      <button
  *ngIf="emi.settled === 0"
  class="btn "
  data-bs-toggle="modal"
  data-bs-target="#openSettleModal"
  (click)="openSettleModal(emi)"
>
  Settle
</button>

<button
  *ngIf="emi.settled === 1"
  class="btn btn-secondary"
  disabled
>
  Settled
</button>
                      <td>{{ emi.due_date | date: 'yyyy-MM-dd' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  
  
</div>




<!-- Modal para Liquidar EMI -->
<!-- Modal for Settling EMI -->
<div class="modal fade" id="openSettleModal" tabindex="-1" aria-labelledby="openSettleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="openSettleModalLabel">Liquidar EMI</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="emiForm">
          <div class="mb-3">
            <label for="amount" class="form-label">Monto Total (Principal + Interés)</label>
            <input type="number" class="form-control" id="amount"
              [value]="selectedEmi ? (selectedEmi.principal_amount + selectedEmi.interest_amount).toFixed(2) : '0.00'" 
              [disabled]="true" />
          </div>
          <div class="mb-3">
            <label for="receivingDate" class="form-label">Fecha de Recepción</label>
            <input type="date" class="form-control" id="receivingDate" formControlName="receivingDate" />
          </div>
          <div class="mb-3">
            <label for="additionalRemarks" class="form-label">Comentarios Adicionales</label>
            <textarea class="form-control" id="additionalRemarks" formControlName="additionalremarks" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" (click)="settleEMI()">Liquidar EMI</button>
      </div>
    </div>
  </div>
</div>
